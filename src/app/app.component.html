<div class="app-container">
  <!-- Left Sidebar -->
  <div class="sidebar">
    <div class="sidebar-header">
      <h1>Letter Composer</h1>
    </div>

    <div class="sidebar-content">
      <!-- Upload Section -->
      <div class="upload-section">
        <div class="upload-item" (click)="onTemplateClick()">
          <div class="upload-icon">üìÑ</div>
          <span>Template (PDF/Image)</span>
          <input type="file" #fileInputTemplate accept="image/*,.pdf" (change)="onTemplateChange($event)" style="display: none;">
        </div>

        <div class="upload-item" (click)="onSignatureClick()">
          <div class="upload-icon">‚úçÔ∏è</div>
          <span>Signature(PDF/Image)</span>
          <input type="file" #fileInputSignature accept="image/*,.pdf" (change)="onSignatureChange($event)" style="display: none;">
        </div>

        <!-- <div class="upload-item" (click)="onLetterBodyClick()">
          <div class="upload-icon">üìã</div>
          <span>Letter Body(PDF/Image/Docx)</span>
          <input type="file" #fileInputLetter accept="image/*,.pdf,.doc,.docx" (change)="onLetterBodyChange($event)" style="display: none;">
        </div> -->
        <div class="upload-item" (click)="openTextBodyModal()">
          <div class="upload-icon">üìù</div>
          <span>Add Text Body</span>
        </div>
      </div>

      <!-- Template Selector -->
<!-- <div class="settings-section">
  <h3>Letter Template</h3>
  <div class="template-selector">
    <select [(ngModel)]="selectedTemplate" class="template-dropdown">
      <option *ngFor="let template of templates" [value]="template.value">
        {{template.name}}
      </option>
    </select>
    <button class="apply-template-btn" (click)="applyTemplate()">
      Apply Template
    </button>
  </div>
</div> -->

      <!-- Background Removal -->
      <!-- <div class="settings-section">
        <h3>Background Removal</h3>
        
        <div class="setting-item">
          <label>Threshold <span class="value">{{threshold}}</span></label>
          <input type="range" [(ngModel)]="threshold" min="1" max="100" class="range-slider">
        </div>

        <div class="setting-item">
          <label>Smoothing <span class="value">{{smoothing}}</span></label>
          <input type="range" [(ngModel)]="smoothing" min="0" max="10" class="range-slider">
        </div>

        <div class="checkbox-item">
          <input type="checkbox" id="autoDetect" [(ngModel)]="autoDetect">
          <label for="autoDetect">Auto-detect</label>
        </div>
      </div> -->

      <!-- Export -->
      <div class="export-section">
        <button class="export-btn primary" (click)="exportAsPDF()">
          <span>üìÑ</span> Export PDF
        </button>
        <!-- <button class="export-btn secondary" (click)="exportAsImage()">
          <span>üñºÔ∏è</span> Export Image
        </button> -->
      </div>

      <!-- Status -->
      <div *ngIf="statusMessage" class="status-bar" [class.success]="statusType === 'success'" [class.error]="statusType === 'error'" [class.processing]="statusType === 'processing'">
        {{statusMessage}}
      </div>
    </div>
  </div>

  <!-- Text Toolbar (Photoshop style) -->
<div class="text-toolbar" *ngIf="isTextMode" [style.z-index]="1000">
    <div class="toolbar-item" [class.active]="fontWeight === 'bold'" (click)="toggleBold()" title="Bold">
      <strong>B</strong>
    </div>
    <div class="toolbar-item italic" [class.active]="fontStyle === 'italic'" (click)="toggleItalic()" title="Italic">
      <em>I</em>
    </div>
    <div class="toolbar-item" [class.active]="textDecoration === 'underline'" (click)="toggleUnderline()" title="Underline">
      <u>U</u>
    </div>
    
    <div class="toolbar-divider"></div>
    
<div class="toolbar-select">
  <div class="toolbar-label">Font:</div>
  <select [(ngModel)]="fontFamily" class="toolbar-dropdown">
    <option *ngFor="let font of fontFamilies" [value]="font">{{font}}</option>
  </select>
</div>

<div class="toolbar-select">
  <div class="toolbar-label">Size:</div>
  <select [(ngModel)]="fontSize" class="toolbar-dropdown size">
    <option *ngFor="let size of fontSizes" [value]="size">{{size}}px</option>
  </select>
</div>
    
    <div class="toolbar-divider"></div>
    
    <div class="toolbar-color">
      <input type="color" [(ngModel)]="textColor" class="color-picker">
    </div>
  </div>

  <!-- Canvas Area -->
  <div class="canvas-area">
    <!-- Top Toolbar -->
    <div class="top-toolbar">
      <div class="toolbar-left">
        <button class="tool-btn" [class.active]="isTextMode" (click)="toggleTextMode()" title="Text Tool">
          <span>T</span>
        </button>
      </div>
      
      <div class="toolbar-center">
        <span class="zoom-label">{{(zoom * 100).toFixed(0)}}%</span>
      </div>
      
      <div class="toolbar-right">
        <button class="zoom-btn" (click)="zoomOut()" title="Zoom Out">
          <span>‚àí</span>
        </button>
        <button class="zoom-btn" (click)="resetZoom()" title="Reset">
          <span>1:1</span>
        </button>
        <button class="zoom-btn" (click)="zoomIn()" title="Zoom In">
          <span>+</span>
        </button>
      </div>
    </div>

    <!-- Canvas Container -->
    <div class="canvas-wrapper" #canvasWrapper>
<canvas 
  #canvas
  tabindex="0"
  [class.text-cursor]="isTextMode"
  (mousedown)="onCanvasMouseDown($event)"
  (mousemove)="onCanvasMouseMove($event)"
  (mouseup)="onCanvasMouseUp()"
  (mouseleave)="onCanvasMouseUp()"
  (keydown)="onKeyDown($event)"
  (paste)="onPaste($event)">
</canvas>
    </div>
  </div>
  <!-- Add this right before closing </div> of canvas-area -->
<div class="page-navigation" *ngIf="getTotalPages() > 1">
  <button class="page-btn" (click)="previousPage()" [disabled]="currentPage === 1">
    ‚Üê Previous
  </button>
  <span class="page-info">Page {{currentPage}} of {{getTotalPages()}}</span>
  <button class="page-btn" (click)="nextPage()" [disabled]="currentPage === getTotalPages()">
    Next ‚Üí
  </button>
</div>
</div>


<!-- REPLACE THE ENTIRE MODAL SECTION WITH THIS -->
<div class="modal-overlay" *ngIf="showTextBodyModal" (click)="closeTextBodyModal()">
  <div class="text-body-modal" (click)="$event.stopPropagation()">
    <div class="upload-item" (click)="openTextBodyModal()">
      <div class="upload-icon">üìù</div>
      <span>Add Text Body</span>
    </div>
    
    <!-- Formatting Toolbar -->
    <div class="text-formatting-toolbar">
      <button class="format-btn" [class.active]="modalFontWeight === 'bold'" (click)="toggleModalBold()" title="Bold">
        <strong>B</strong>
      </button>
      <button class="format-btn italic" [class.active]="modalFontStyle === 'italic'" (click)="toggleModalItalic()" title="Italic">
        <em>I</em>
      </button>
      <button class="format-btn" [class.active]="modalTextDecoration === 'underline'" (click)="toggleModalUnderline()" title="Underline">
        <u>U</u>
      </button>
      
      <div class="toolbar-divider"></div>
      
      <select [(ngModel)]="modalFontFamily" class="format-select">
        <option *ngFor="let font of fontFamilies" [value]="font">{{font}}</option>
      </select>
      
      <select [(ngModel)]="modalFontSize" class="format-select size">
        <option *ngFor="let size of fontSizes" [value]="size">{{size}}px</option>
      </select>
      
      <div class="toolbar-divider"></div>
      
      <div class="format-align-group">
        <button class="format-btn" title="Align Left">
          <svg width="16" height="16" viewBox="0 0 16 16"><path d="M0 2h16v2H0zm0 4h10v2H0zm0 4h16v2H0zm0 4h10v2H0z" fill="currentColor"/></svg>
        </button>
        <button class="format-btn" title="Align Center">
          <svg width="16" height="16" viewBox="0 0 16 16"><path d="M0 2h16v2H0zm3 4h10v2H3zm-3 4h16v2H0zm3 4h10v2H3z" fill="currentColor"/></svg>
        </button>
        <button class="format-btn" title="Align Right">
          <svg width="16" height="16" viewBox="0 0 16 16"><path d="M0 2h16v2H0zm6 4h10v2H6zm-6 4h16v2H0zm6 4h10v2H6z" fill="currentColor"/></svg>
        </button>
      </div>
      
      <div class="toolbar-divider"></div>
      
      <button class="format-btn" title="Bulleted List">
        <svg width="16" height="16" viewBox="0 0 16 16"><circle cx="2" cy="3" r="1.5"/><circle cx="2" cy="8" r="1.5"/><circle cx="2" cy="13" r="1.5"/><path d="M5 2h11v2H5zm0 5h11v2H5zm0 5h11v2H5z" fill="currentColor"/></svg>
      </button>
      <button class="format-btn" title="Numbered List">
        <svg width="16" height="16" viewBox="0 0 16 16"><path d="M1 1h2v4H1zm0 5h2v4H1zm0 5h2v4H1zM5 2h11v2H5zm0 5h11v2H5zm0 5h11v2H5z" fill="currentColor"/></svg>
      </button>
      
      <input type="color" [(ngModel)]="modalTextColor" class="color-picker" title="Text Color">
    </div>
    
    <div class="modal-body">
      <textarea 
        #textBodyArea
        [(ngModel)]="textBodyContent" 
        class="text-body-textarea"
        placeholder="Type or paste your letter content here..."
        [style.fontFamily]="modalFontFamily"
        [style.fontSize.px]="modalFontSize"
        [style.fontWeight]="modalFontWeight"
        [style.fontStyle]="modalFontStyle"
        [style.textDecoration]="modalTextDecoration"
        [style.color]="modalTextColor">
      </textarea>
    </div>
    
    <div class="modal-footer">
      <button class="modal-btn cancel" (click)="closeTextBodyModal()">Cancel</button>
      <button class="modal-btn confirm" (click)="applyTextBody()">Apply</button>
    </div>
  </div>
</div>